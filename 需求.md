# 技术规格说明书：基于 Python 的睡眠健康数据挖掘项目

**版本**：1.0
**适用场景**：AI 代码生成 / 项目开发文档
**数据源文件**：`sleep_health_lifestyle_dataset.csv`

---

## 1. 项目环境与依赖 (Environment & Dependencies)

**目标**：构建一个基于 Python 的数据分析脚本，涵盖数据清洗、探索性分析 (EDA) 和特征重要性挖掘。

**技术栈要求**：
* **语言**：Python 3.x
* **核心库**：
    * `pandas`：用于数据读取与处理。
    * `numpy`：用于数值计算。
    * `seaborn` & `matplotlib.pyplot`：用于绘制高质量统计图表。
    * `sklearn.ensemble.RandomForestRegressor`：用于特征重要性建模。
    * `sklearn.preprocessing.LabelEncoder`：用于分类变量编码。

---

## 2. 数据模式与定义 (Data Schema)

**原始列名与预期处理逻辑**：

| 原始列名 | 类型 | 处理指令 |
| :--- | :--- | :--- |
| `Person ID` | ID | **[删除]** 无分析价值，读入后直接 Drop。 |
| `Gender` | Categorical | 保留用于分组。 |
| `Age` | Numeric | 连续变量。 |
| `Occupation` | Categorical | 职业字段。 |
| `Sleep Duration (hours)` | Numeric | **[目标变量1]** 睡眠时长。 |
| `Quality of Sleep (scale: 1-10)` | Numeric | **[核心目标变量]** 睡眠质量。 |
| `Physical Activity Level (minutes/day)` | Numeric | 特征变量。 |
| `Stress Level (scale: 1-10)` | Numeric | 特征变量。 |
| `BMI Category` | Categorical | 需要进行数值编码。 |
| `Blood Pressure (systolic/diastolic)` | String | **[需清洗]** 格式为 "126/83"，需拆分为两列。 |
| `Heart Rate (bpm)` | Numeric | 特征变量。 |
| `Daily Steps` | Numeric | 特征变量。 |
| `Sleep Disorder` | Categorical | **[含缺失值]** 需填充处理。 |

---

## 3. 数据预处理流水线 (ETL Pipeline)

**请严格按照以下顺序生成数据清洗代码：**

### 步骤 3.1：缺失值处理
* **目标列**：`Sleep Disorder`
* **逻辑**：该列中的 `NaN` 值表示“无睡眠障碍”。
* **操作**：使用 `fillna('None')` 进行填充。

### 步骤 3.2：特征工程（血压拆分）
* **目标列**：`Blood Pressure (systolic/diastolic)`
* **逻辑**：
    1.  使用 `/` 作为分隔符将字符串进行拆分 (Split)。
    2.  生成新列 `Systolic_BP` (收缩压) -> 转换为 `int` 类型。
    3.  生成新列 `Diastolic_BP` (舒张压) -> 转换为 `int` 类型。
    4.  删除原始的 `Blood Pressure` 列。

### 步骤 3.3：数值编码 (Encoding)
* **场景**：为了计算相关性矩阵（Correlation Matrix）和构建机器学习模型。
* **操作**：
    1.  创建一个数据副本，命名为 `df_encoded`。
    2.  对以下分类列使用 `LabelEncoder` 进行转换：
        * `Gender`
        * `Occupation`
        * `BMI Category`
        * `Sleep Disorder`

---

## 4. 分析与可视化任务清单 (Analysis Tasks)

请生成代码绘制以下 4 组关键图表，每张图表需包含清晰的标题 (Title) 和坐标轴标签 (Labels)。建议设置全局画布大小为 `(14, 10)` 或根据子图调整。

### 任务 A：宏观相关性分析 (The "Map")
* **图表类型**：热力图 (Seaborn Heatmap)。
* **数据源**：`df_encoded` (包含所有数值和编码后的分类变量)。
* **关键参数**：设置 `annot=True` 以显示数值，`cmap='coolwarm'`。
* **目的**：展示 `Quality of Sleep` 与 `Physical Activity Level`, `Stress Level`, `Heart Rate` 等变量的相关系数。

### 任务 B：生活方式闭环 (The "Lifestyle Loop")
* **图表类型**：带有回归线的散点图 (Seaborn Regplot)。
* **X轴**：`Physical Activity Level (minutes/day)`
* **Y轴**：`Quality of Sleep (scale: 1-10)`
* **目的**：直观验证“运动越多，睡眠质量越高”的假设。

### 任务 C：职业压力分析 (The "Stress Gap")
* **图表类型**：箱线图 (Boxplot)。
* **X轴**：`Occupation` (请按 `Stress Level` 的中位数降序排列，以便观察)。
* **Y轴**：`Stress Level (scale: 1-10)`
* **颜色分组 (Hue)**：可选 `Gender`。
* **目的**：找出哪些职业压力最大（例如 Sales Representative vs Engineer）。

### 任务 D：健康后果分析 (The "Health Impact")
* **图表类型**：分组条形图 (Countplot)。
* **X轴**：`BMI Category`
* **颜色分组 (Hue)**：`Sleep Disorder`
* **目的**：展示 `Obese` (肥胖) 人群中 `Sleep Apnea` (睡眠呼吸暂停) 的高发率。

---

## 5. 深度挖掘：特征重要性 (Machine Learning)

**目的**：利用算法量化各个因素对“睡眠质量”的影响权重。

**算法配置**：
* **模型**：随机森林回归 (`RandomForestRegressor`)。
* **参数**：`n_estimators=100`, `random_state=42`。

**实施步骤**：
1.  **特征集 (X)**：使用 `df_encoded`，排除 `Person ID` 和目标变量 `Quality of Sleep (scale: 1-10)`。
2.  **目标变量 (y)**：`Quality of Sleep (scale: 1-10)`。
3.  **训练**：拟合模型 (`fit`)。
4.  **输出**：提取 `feature_importances_`，创建一个 DataFrame 并按重要性降序排列，最后绘制条形图展示 Top 因素。

---

## 6. 代码输出要求 (Output Requirements)

1.  **代码注释**：代码必须包含详细注释，解释数据清洗和绘图的每一步逻辑。
2.  **图表美观**：请使用 `sns.set(style="whitegrid")` 提升图表质感。
3.  **文本总结**：脚本运行结束时，请打印一段简单的文本分析结果（例如：“与睡眠质量相关性最高的特征是：XXX”）。